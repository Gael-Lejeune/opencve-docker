EXEC=docker exec
COMPOSE=docker-compose

# Initialize the database
upgrade: up
	$(EXEC) -it webserver opencve upgrade-db

# Build the OpenCVE image
build:
	$(COMPOSE) build

# Create the containers and start them
up: build
	$(COMPOSE) up -d postgres redis webserver celery_worker

# Import the data
import:
	$(EXEC) -it webserver opencve import-data

import-light:
	$(EXEC) -it webserver opencve import-data-light

# Create and start the beat
beat:
	$(COMPOSE) up -d celery_beat

# CARE : This will remove any unused volume
clean:
	docker container stop celery_worker webserver postgres redis
	docker container rm celery_worker webserver postgres redis
	docker network rm opencve-docker_backend
	docker volume prune -f

.PHONY: build up upgrade import
from flask import request, render_template

from opencve.controllers.main import main
from opencve.controllers.products import ProductController
from flask_user import current_user
from opencve.models.clients import Client

@main.route("/vendors/<vendor>/products")
def products(vendor):
    products, _, pagination = ProductController.list({**request.args, "vendor": vendor})
    user_clients_names = []
    for c in current_user.clients:
        user_clients_names.append(c.name)
    current_clients=Client.query.filter(Client.name.in_(user_clients_names)).all()
    return render_template(
        "products.html",
        products=products,
        vendor=vendor,
        pagination=pagination,
        current_clients=current_clients
    )
